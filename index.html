<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mostrar Pedidos</title>
    <link rel="stylesheet" href="estilos.css">
    
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-app.js";
        import { getFirestore, collection, onSnapshot } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-firestore.js";

        // Configura tu objeto de configuraci贸n de Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyD2Pysgp_7IYKa8b3VN3wG55ly0saR8AMU",
            authDomain: "proyecto-bar-b79c8.firebaseapp.com",
            projectId: "proyecto-bar-b79c8",
            storageBucket: "proyecto-bar-b79c8.appspot.com",
            messagingSenderId: "629613959942",
            appId: "1:629613959942:web:5eee0d55059f6be32a9c87"
        };

        // Inicializa Firebase
        const app = initializeApp(firebaseConfig);

        // Inicializa Firestore
        const db = getFirestore(app);

        function formatearFecha(timestamp) {
            const fecha = new Date(timestamp * 1000);
            const options = { day: 'numeric', month: 'numeric', year: 'numeric', hour: 'numeric', minute: 'numeric', second: 'numeric' };
            return fecha.toLocaleDateString('es-ES', options);
        }

        // Escucha cambios en la colecci贸n "pedidos"
        onSnapshot(collection(db, "pedidos"), (querySnapshot) => {
            // Limpia el contenido existente antes de agregar nuevos datos
            const contenedorPedidos = document.getElementById("contenedorPedidos");
            contenedorPedidos.innerHTML = "";

            // Almacena los documentos en un array y los ordena por timestamp (en orden descendente)
            const pedidosArray = [];
            querySnapshot.forEach((doc) => {
                pedidosArray.push(doc);
            });

            pedidosArray.sort((a, b) => {
                return b.data().timestamp.seconds - a.data().timestamp.seconds;
            });

            // Itera sobre los documentos ordenados
            pedidosArray.forEach((doc) => {
                const pedido = doc.data();
                
                // Agrega el contenido a tu contenedor HTML
                const detallePedido = document.createElement("div");
                detallePedido.classList.add('info');

                // Agregar la informaci贸n de la mesa y la hora
                detallePedido.innerHTML = `
                    <h3>MESA: ${pedido.numeroMesa}</h3>
                    <h4> ${formatearFecha(pedido.timestamp.seconds)}</h4>
                `;

                // Ordenar los productos por nombre antes de presentarlos
                const productosOrdenados = Object.entries(pedido.productos).sort((a, b) => {
                    return a[1].nombre.localeCompare(b[1].nombre);
                });

                // Iterar sobre los productos ordenados y agregar la informaci贸n de nombre, cantidad y precio
                productosOrdenados.forEach(([productoKey, producto]) => {
                    const productoInfo = document.createElement("div");
                    productoInfo.classList.add('detalle');
                    productoInfo.innerHTML = `
                        <p>${producto.nombre} ${producto.cantidad} = $${producto.presio}</p>
                    `;
                    detallePedido.appendChild(productoInfo);
                });

                // Agregar el total al detalle del pedido
                detallePedido.innerHTML += `<h3>Total: $${pedido.precioTotal}</h3>`;

                // Agregar el detalle del pedido al contenedor principal
                contenedorPedidos.appendChild(detallePedido);
            });
        });
    </script>
</head>
<body>
    <h1>Mostrar Pedidos</h1>
    <div id="contenedorPedidos" class="contenedor"></div>
</body>
</html>
